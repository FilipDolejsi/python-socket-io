<!DOCTYPE html>
<html>
    <head>
      <meta charset="utf-8">
      <title>
        Cellar simulator
      </title>

      <style>
        .demo-card-event.mdl-card {
          width: 256px;
          height: 256px;
          background: #3E4EB8;
        }
        .demo-card-event > .mdl-card__actions {
          border-color: rgba(255, 255, 255, 0.2);
        }
        .demo-card-event > .mdl-card__title {
          align-items: flex-start;
        }
        .demo-card-event > .mdl-card__title > h4 {
          margin-top: 0;
        }
        .demo-card-event > .mdl-card__actions {
          display: flex;
          box-sizing:border-box;
          align-items: center;
        }
        .demo-card-event > .mdl-card__actions > .material-icons {
          padding-right: 10px;
        }
        .demo-card-event > .mdl-card__title,
        .demo-card-event > .mdl-card__actions,
        .demo-card-event > .mdl-card__actions > .mdl-button {
          color: #fff;
        }
        </style>
        

      <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script> -->
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
      <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
      <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.js"></script>

      <script type="text/javascript">

        function init() {
          const socket = io()
          const loggerElement = document.getElementById('logger')
          const actionsElement = document.getElementsByTagName("actions")[0]
  
          socket.on('log', function(payload) {
            console.log(payload);
            const dataElement = document.createElement('pre')
            dataElement.innerHTML = payload.data
            loggerElement.appendChild(dataElement)
          })

          socket.on('atomics', function(payload){
              const newSliderValue = payload.water_level;
              const newToggleValue = payload.water_is_rising;

              const toggleSwitch = document.getElementById("water_is_rising");
              const slider = document.getElementById("water_level");

              if(newToggleValue){
                toggleSwitch.parentElement.MaterialSwitch.on();
              }
              else{
                toggleSwitch.parentElement.MaterialSwitch.off();
              }
              slider.value = newSliderValue;
          })
  
          socket.on('action', function(payload) {
            console.log(payload);
            const actionCard = document.createElement('div');
            actionCard.id = payload['Action'];
            actionCard.className = "demo-card-event mdl-card mdl-shadow--2dp  mdl-cell mdl-cell--4-col";
            actionCard.innerHTML = `<div class="mdl-card__title mdl-card--expand">
              <h4>
                Steps:
                <ul>
                  <li>Do this...</li>
                  <li>Do that...</li>
                </ul>
              </h4>
            </div>
            <div class="mdl-card__actions mdl-card--border">
              <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                ${payload["Action"]}
              </a>
              <div class="mdl-layout-spacer"></div>
              <i class="material-icons">event</i>
            </div>`
            actionsElement.appendChild(actionCard)
            actionCard.onclick = function () {
              socket.emit('completed_action', payload["Action"]);
              actionsElement.removeChild(actionCard);
            }
          })

          document.getElementById('water_level').onchange = function(event) {
            const slider = document.getElementById('water_level');
            const payload = {}
            payload["water_level"] = slider.value;
            socket.emit('state_update', payload);
          }

          document.getElementById('water_is_rising').onchange = function(event) {
            const toggleSwitch = document.getElementById("water_is_rising");
            const payload = {};
            payload["water_is_rising"] = toggleSwitch.checked;
            socket.emit('state_update', payload);
          }
        }
  
          </script>
  
    </head>
    <body onload="init()">
      <div id="logger"></div>
      
        <h1>Cellar simulator</h1>
        <h2>State</h2>

        <state>
          <!-- Slider with Starting Value -->
          Water level <input id = "water_level" class="mdl-slider mdl-js-slider" type="range" min="0" max="100" value="0" tabindex="0">  
          <!-- toggle switch, switched on--> 
          <label id="water_is_rising_label" class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="water_is_rising">
            <input type="checkbox" id="water_is_rising" class="mdl-switch__input">
            <span class="mdl-switch__label">Water is rising</span>
          </label>
        </state>

        <h2>Actions</h2>
        <!-- <div class="mdl-grid">
          <div class="mdl-cell mdl-cell--4-col">4</div>
          <div class="mdl-cell mdl-cell--4-col">4</div>
          <div class="mdl-cell mdl-cell--4-col">4</div>
        </div> -->
        <actions class="mdl-grid">
          <!-- <div class="mdl-cell mdl-cell--4-col demo-card-event mdl-card mdl-shadow--2dp">
            <div class="mdl-card__title mdl-card--expand">
              <h4>
                Steps:
                <ul>
                  <li>Do this...</li>
                  <li>Do that...</li>
                </ul>
              </h4>
            </div>
            <div class="mdl-card__actions mdl-card--border">
              <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                Done!
              </a>
              <div class="mdl-layout-spacer"></div>
              <i class="material-icons">event</i>
            </div>
          </div>
          <div class="mdl-cell mdl-cell--4-col demo-card-event mdl-card mdl-shadow--2dp">
            <div class="mdl-card__title mdl-card--expand">
              <h4>
                Steps:
                <ul>
                  <li>Do this...</li>
                  <li>Do that...</li>
                </ul>
              </h4>
            </div>
            <div class="mdl-card__actions mdl-card--border">
              <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                Done!
              </a>
              <div class="mdl-layout-spacer"></div>
              <i class="material-icons">event</i>
            </div>
          </div> -->
        </actions>
    </body>
</html>


